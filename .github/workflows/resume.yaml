name: Update Resume

on:
  pull_request:
  workflow_dispatch:

jobs:
  update-resume:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download PDF
      run: |
        url="https://app.flowcv.com/api/public/download_resume?token=${{ secrets.FLOWCV_TOKEN }}"
        output_file="latest.pdf"

        # Attempt to download the PDF
        if ! curl -L -o "$output_file" "$url"; then
          echo "Failed to download the PDF from $url"
          exit 1
        fi

    - name: Commit and push the new resume
      run: |
        cp latest.pdf public/jatin-resume.pdf
        git config --global user.name 'Jatin'
        git config --global user.email 'heyjatinn@gmail.com'
        git add public/jatin-resume.pdf
        git commit -m "chore: update resume"
        git push origin HEAD:main